/*! tiledstreaming4dash 2015-12-23 */
"use strict";function crossOriginRequest(a,b){function c(a,b){var c;return c=f?new window.XDomainRequest:new XMLHttpRequest}function d(){g?f?(g.onload=returnResult,g.open("GET",a,!0),g.send()):(g.open("GET",a,!0),g.onreadystatechange=e,g.send()):console.log("callOtherDomain: No Invocation TookPlace At All")}function e(a){if(4==g.readyState)if(200==g.status){var c=g.responseText;b(null,c)}else console.log("crossOriginRequestHandler: Invocation Errors Occured")}var f=window.XDomainRequest?!0:!1,g=c();d()}function X2JS(a,b,c){function d(a){var b=a.localName;return null==b&&(b=a.baseName),(null==b||""==b)&&(b=a.nodeName),b}function e(a){return a.prefix}function f(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):a}function g(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function h(f){if(f.nodeType==u.DOCUMENT_NODE){var i,j,k,l=f.firstChild;for(j=0,k=f.childNodes.length;k>j;j+=1)if(f.childNodes[j].nodeType!==u.COMMENT_NODE){l=f.childNodes[j];break}if(c)i=h(l);else{i={};var m=d(l);i[m]=h(l)}return i}if(f.nodeType==u.ELEMENT_NODE){var i=new Object;i.__cnt=0;for(var n=[],o=f.childNodes,p=0;p<o.length;p++){var l=o.item(p),m=d(l);if(i.__cnt++,null==i[m]){var q=h(l);if("#text"!=m||/[^\s]/.test(q)){var r={};r[m]=q,n.push(r)}i[m]=q,i[m+"_asArray"]=new Array(1),i[m+"_asArray"][0]=i[m]}else{if(null!=i[m]&&!(i[m]instanceof Array)){var s=i[m];i[m]=new Array,i[m][0]=s,i[m+"_asArray"]=i[m]}for(var v=0;null!=i[m][v];)v++;var q=h(l);if("#text"!=m||/[^\s]/.test(q)){var r={};r[m]=q,n.push(r)}i[m][v]=q}}i.__children=n;for(var w=0;w<f.attributes.length;w++){var x=f.attributes.item(w);i.__cnt++;for(var y=x.value,z=0,A=a.length;A>z;z++){var B=a[z];B.test.call(this,x)&&(y=B.converter.call(this,x.value))}i[b+x.name]=y}var C=e(f);return null!=C&&""!=C&&(i.__cnt++,i.__prefix=C),1==i.__cnt&&null!=i["#text"]&&(i=i["#text"]),null!=i["#text"]&&(i.__text=i["#text"],t&&(i.__text=g(i.__text)),delete i["#text"],delete i["#text_asArray"]),null!=i["#cdata-section"]&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],delete i["#cdata-section_asArray"]),(null!=i.__text||null!=i.__cdata)&&(i.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),i}return f.nodeType==u.TEXT_NODE||f.nodeType==u.CDATA_SECTION_NODE?f.nodeValue:f.nodeType==u.COMMENT_NODE?null:void 0}function i(a,b,c,d){var e="<"+(null!=a&&null!=a.__prefix?a.__prefix+":":"")+b;if(null!=c)for(var f=0;f<c.length;f++){var g=c[f],h=a[g];e+=" "+g.substr(1)+"='"+h+"'"}return e+=d?"/>":">"}function j(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function k(a,b){return-1!==a.indexOf(b,a.length-b.length)}function l(a,b){return k(b.toString(),"_asArray")||0==b.toString().indexOf("_")||a[b]instanceof Function?!0:!1}function m(a){var b=0;if(a instanceof Object)for(var c in a)l(a,c)||b++;return b}function n(a){var b=[];if(a instanceof Object)for(var c in a)-1==c.toString().indexOf("__")&&0==c.toString().indexOf("_")&&b.push(c);return b}function o(a){var b="";return null!=a.__cdata&&(b+="<![CDATA["+a.__cdata+"]]>"),null!=a.__text&&(b+=t?f(a.__text):a.__text),b}function p(a){var b="";return a instanceof Object?b+=o(a):null!=a&&(b+=t?f(a):a),b}function q(a,b,c){var d="";if(0==a.length)d+=i(a,b,c,!0);else for(var e=0;e<a.length;e++)d+=i(a[e],b,n(a[e]),!1),d+=r(a[e]),d+=j(a[e],b);return d}function r(a){var b="",c=m(a);if(c>0)for(var d in a)if(!l(a,d)){var e=a[d],f=n(e);if(null==e||void 0==e)b+=i(e,d,f,!0);else if(e instanceof Object)if(e instanceof Array)b+=q(e,d,f);else{var g=m(e);g>0||null!=e.__text||null!=e.__cdata?(b+=i(e,d,f,!1),b+=r(e),b+=j(e,d)):b+=i(e,d,f,!0)}else b+=i(e,d,f,!1),b+=p(e),b+=j(e,d)}return b+=p(a)}(null===b||void 0===b)&&(b="_"),(null===c||void 0===c)&&(c=!1);var s="1.0.11",t=!1,u={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(a){var b,c,d;if(window.DOMParser){c=new window.DOMParser;try{d=c.parseFromString("<","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(e){}try{b=c.parseFromString(a,"text/xml"),d&&b.getElementsByTagNameNS(d,"parsererror").length&&(b=void 0)}catch(e){}}else 0==a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},this.xml2json=function(a){return h(a)},this.xml_str2json=function(a){var b=this.parseXmlString(a);return b?this.xml2json(b):void 0},this.json2xml_str=function(a){return r(a)},this.json2xml=function(a){var b=this.json2xml_str(a);return this.parseXmlString(b)},this.getVersion=function(){return s},this.escapeMode=function(a){t=a}}function launchDashPlayer(a){var b=new Dash.di.DashContext,c=new MediaPlayer(b);return c.setAutoPlay(!1),c.startup(),c.attachView(document.querySelector("#"+a)),c}function openVideo(){bannerbox.style.visibility="hidden";var a=document.getElementById("mpdURL").value;MPDManager(a)}function playPause(){videonormal.paused?(videonormal.play(),video1.play(),video2.play(),video3.play(),video4.play()):(videonormal.pause(),video1.pause(),video2.pause(),video3.pause(),video4.pause())}function makeBig(){videonormal.width=560,videoContainer.width=560,videoContainer.height=315,video1.width=560,video2.width=560,video3.width=560,video4.width=560}function makeSmall(){videonormal.width=320,videoContainer.width=320,videoContainer.height=180,video1.width=320,video2.width=320,video3.width=320,video4.width=320}function makeNormal(){videonormal.width=420,videoContainer.width=420,videoContainer.height=236,video1.width=420,video2.width=420,video3.width=420,video4.width=420}function swapVideos(){return"visible"==videonormal.style.visibility&&"hidden"==tiletable.style.visibility?(videonormal.style.visibility="hidden",void(tiletable.style.visibility="visible")):"hidden"==videonormal.style.visibility&&"visible"==tiletable.style.visibility?(videonormal.style.visibility="visible",void(tiletable.style.visibility="hidden")):void 0}function getClickPosition(a){var b=getPosition(a.currentTarget),c=a.clientX-b.x-tiletable.clientWidth/2,d=a.clientY-b.y-tiletable.clientHeight/2;setTimeout(function(){swapVideos(),tiletable.style.left=c+"px",tiletable.style.top=d+"px"},600)}function getPosition(a){for(var b=0,c=0;a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop,a=a.offsetParent;return{x:b,y:c}}var bannerbox,videonormal,tiletable,video1,video2,video3,video4,videoElements;$(document).ready(function(){bannerbox=document.getElementById("bannerbox"),videonormal=document.getElementById("videonormal"),tiletable=document.getElementById("tiletable"),video1=document.getElementById("video1"),video2=document.getElementById("video2"),video3=document.getElementById("video3"),video4=document.getElementById("video4"),videoElements=["videonormal","video1","video2","video3","video4"],videonormal.style.visibility="visible",tiletable.style.visibility="hidden",video1.muted=!0,video2.muted=!0,video3.muted=!0,video4.muted=!0,SynchroniseVideos()});var SynchroniseVideos=function(){var a={a:Popcorn("#videonormal"),b:Popcorn("#video1"),c:Popcorn("#video2"),d:Popcorn("#video3"),e:Popcorn("#video4")},b=$("#scrub"),c=0,d="play pause timeupdate seeking".split(/\s+/g);Popcorn.forEach(a,function(e,f){e.on("canplayall",function(){this.emit("syncVideos"),b.attr("max",this.duration())}).on("syncVideos",function(){4==++c&&d.forEach(function(c){a.a.on(c,function(){if("timeupdate"===c){if(!this.media.paused)return;return a.b.emit("timeupdate"),a.c.emit("timeupdate"),a.d.emit("timeupdate"),a.e.emit("timeupdate"),void b.val(this.currentTime())}"seeking"===c&&(a.b.currentTime(this.currentTime()),a.c.currentTime(this.currentTime()),a.d.currentTime(this.currentTime()),a.e.currentTime(this.currentTime())),("play"===c||"pause"===c)&&(a.b[c](),a.c[c](),a.d[c](),a.e[c]())})})})}),b.bind("change",function(){var b=this.value;a.a.currentTime(b),a.b.currentTime(b),a.c.currentTime(b),a.d.currentTime(b),a.e.currentTime(b)})},lastUid=-1,ServiceBus={topics:{},subscribe:function(a,b,c){this.topics[a]||(this.topics[a]=[]);var d=(++lastUid).toString();this.topics[a].push({listener:b,token:d,subscriber:c});var c=c;return console.log("Subscribing "+c+" to topic "+a),d},unsubscribe:function(a,b){for(var c=0;c<this.topics[a].length;c++)this.topics[a][c].token===b&&(console.log("Unsubscribing "+this.topics[a][c].subscriber+" from topic"+a),this.topics[a].splice(c,1))},publish:function(a,b){var c=this.topics[a].length;if(this.topics[a]&&!(1>c))for(var d=0;c>d;d++){var e=this.topics[a][d].listener;console.log("Publishing topic "+a+" to subscriber "+this.topics[a][d].subscriber),e(b||{})}}},SECONDS_IN_YEAR=31536e3,SECONDS_IN_MONTH=2592e3,SECONDS_IN_DAY=86400,SECONDS_IN_HOUR=3600,SECONDS_IN_MIN=60,MINUTES_IN_HOUR=60,MILLISECONDS_IN_SECONDS=1e3,durationRegex=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,datetimeRegex=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,numericRegex=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,httpOrHttpsRegex=/^https?:\/\//i,matchers=[{type:"duration",test:function(a){for(var b=["minBufferTime","mediaPresentationDuration","minimumUpdatePeriod","timeShiftBufferDepth","maxSegmentDuration","maxSubsegmentDuration","suggestedPresentationDelay","start","starttime","duration"],c=b.length,d=0;c>d;d++)if(a.nodeName===b[d])return durationRegex.test(a.value);return!1},converter:function(a){var b=durationRegex.exec(a),c=parseFloat(b[2]||0)*SECONDS_IN_YEAR+parseFloat(b[4]||0)*SECONDS_IN_MONTH+parseFloat(b[6]||0)*SECONDS_IN_DAY+parseFloat(b[8]||0)*SECONDS_IN_HOUR+parseFloat(b[10]||0)*SECONDS_IN_MIN+parseFloat(b[12]||0);return void 0!==b[1]&&(c=-c),c}},{type:"datetime",test:function(a){return datetimeRegex.test(a.value)},converter:function(a){var b,c=datetimeRegex.exec(a);if(b=Date.UTC(parseInt(c[1],10),parseInt(c[2],10)-1,parseInt(c[3],10),parseInt(c[4],10),parseInt(c[5],10),c[6]&&parseInt(c[6],10)||0,c[7]&&parseFloat(c[7])*MILLISECONDS_IN_SECONDS||0),c[9]&&c[10]){var d=parseInt(c[9],10)*MINUTES_IN_HOUR+parseInt(c[10],10);b+=("+"===c[8]?-1:1)*d*SECONDS_IN_MIN*MILLISECONDS_IN_SECONDS}return new Date(b)}},{type:"numeric",test:function(a){return numericRegex.test(a.value)},converter:function(a){return parseFloat(a)}}],MPDRetriever=function(a){this.params=a};MPDRetriever.prototype={retrieveAndConvert:function(a,b){crossOriginRequest(a,function(a,c){return a?console.err(a):void b(null,c)})},getMPD:function(){this.retrieveAndConvert(this.params.mpdURL,function(a,b){return a?console.err(a):void ServiceBus.publish("MPD-incoming",b)})}};var MPDParser=function(){ServiceBus.subscribe("MPD-incoming",this.parseMPD,"MPDParser")};MPDParser.prototype={parseMPD:function(a){var b=new X2JS(matchers,"",!0),c=b.parseXmlString(a),d=b.xml2json(c);ServiceBus.publish("Non-SRD-MPD",d)}};var normalVideoAttacher=function(){ServiceBus.subscribe("Non-SRD-MPD",this.attacher,"normalVideoAttacher")};normalVideoAttacher.prototype={attacher:function(a){var b=launchDashPlayer("videonormal");b.attachSource(a),$.when(4===videonormal.readyState).then(setTimeout(function(){playPause()},1))}};var tiledVideoAttacher=function(){ServiceBus.subscribe("SRD-MPD",this.attacher,"tiledVideoAttacher")};tiledVideoAttacher.prototype={attacher:function(a){for(var b=[],c=0;c<videoElements.length;c++){var d=videoElements[c],e=launchDashPlayer(d);b.push(e),videoContainer.addEventListener("click",getClickPosition,!1)}}};var MPDManager=function(a){new normalVideoAttacher,new tiledVideoAttacher,new MPDParser;var b=new MPDRetriever;b.params={mpdURL:a},b.getMPD()};