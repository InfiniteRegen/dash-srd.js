/*! tiledstreaming4dash 2016-02-02 */
"use strict";function crossOriginRequest(a,b){function c(a,b){var c;return c=f?new window.XDomainRequest:new XMLHttpRequest}function d(){g?f?(g.onload=returnResult,g.open("GET",a,!0),g.send()):(g.open("GET",a,!0),g.onreadystatechange=e,g.send()):console.log("callOtherDomain: No Invocation TookPlace At All")}function e(a){if(4==g.readyState)if(200==g.status){var c=g.responseText;b(null,c)}else console.log("crossOriginRequestHandler: Invocation Errors Occured")}var f=window.XDomainRequest?!0:!1,g=c();d()}function X2JS(a,b,c){function d(a){var b=a.localName;return null==b&&(b=a.baseName),(null==b||""==b)&&(b=a.nodeName),b}function e(a){return a.prefix}function f(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):a}function g(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function h(f){if(f.nodeType==u.DOCUMENT_NODE){var i,j,k,l=f.firstChild;for(j=0,k=f.childNodes.length;k>j;j+=1)if(f.childNodes[j].nodeType!==u.COMMENT_NODE){l=f.childNodes[j];break}if(c)i=h(l);else{i={};var m=d(l);i[m]=h(l)}return i}if(f.nodeType==u.ELEMENT_NODE){var i=new Object;i.__cnt=0;for(var n=[],o=f.childNodes,p=0;p<o.length;p++){var l=o.item(p),m=d(l);if(i.__cnt++,null==i[m]){var q=h(l);if("#text"!=m||/[^\s]/.test(q)){var r={};r[m]=q,n.push(r)}i[m]=q,i[m+"_asArray"]=new Array(1),i[m+"_asArray"][0]=i[m]}else{if(null!=i[m]&&!(i[m]instanceof Array)){var s=i[m];i[m]=new Array,i[m][0]=s,i[m+"_asArray"]=i[m]}for(var v=0;null!=i[m][v];)v++;var q=h(l);if("#text"!=m||/[^\s]/.test(q)){var r={};r[m]=q,n.push(r)}i[m][v]=q}}i.__children=n;for(var w=0;w<f.attributes.length;w++){var x=f.attributes.item(w);i.__cnt++;for(var y=x.value,z=0,A=a.length;A>z;z++){var B=a[z];B.test.call(this,x)&&(y=B.converter.call(this,x.value))}i[b+x.name]=y}var C=e(f);return null!=C&&""!=C&&(i.__cnt++,i.__prefix=C),1==i.__cnt&&null!=i["#text"]&&(i=i["#text"]),null!=i["#text"]&&(i.__text=i["#text"],t&&(i.__text=g(i.__text)),delete i["#text"],delete i["#text_asArray"]),null!=i["#cdata-section"]&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],delete i["#cdata-section_asArray"]),(null!=i.__text||null!=i.__cdata)&&(i.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),i}return f.nodeType==u.TEXT_NODE||f.nodeType==u.CDATA_SECTION_NODE?f.nodeValue:f.nodeType==u.COMMENT_NODE?null:void 0}function i(a,b,c,d){var e="<"+(null!=a&&null!=a.__prefix?a.__prefix+":":"")+b;if(null!=c)for(var f=0;f<c.length;f++){var g=c[f],h=a[g];e+=" "+g.substr(1)+"='"+h+"'"}return e+=d?"/>":">"}function j(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function k(a,b){return-1!==a.indexOf(b,a.length-b.length)}function l(a,b){return k(b.toString(),"_asArray")||0==b.toString().indexOf("_")||a[b]instanceof Function?!0:!1}function m(a){var b=0;if(a instanceof Object)for(var c in a)l(a,c)||b++;return b}function n(a){var b=[];if(a instanceof Object)for(var c in a)-1==c.toString().indexOf("__")&&0==c.toString().indexOf("_")&&b.push(c);return b}function o(a){var b="";return null!=a.__cdata&&(b+="<![CDATA["+a.__cdata+"]]>"),null!=a.__text&&(b+=t?f(a.__text):a.__text),b}function p(a){var b="";return a instanceof Object?b+=o(a):null!=a&&(b+=t?f(a):a),b}function q(a,b,c){var d="";if(0==a.length)d+=i(a,b,c,!0);else for(var e=0;e<a.length;e++)d+=i(a[e],b,n(a[e]),!1),d+=r(a[e]),d+=j(a[e],b);return d}function r(a){var b="",c=m(a);if(c>0)for(var d in a)if(!l(a,d)){var e=a[d],f=n(e);if(null==e||void 0==e)b+=i(e,d,f,!0);else if(e instanceof Object)if(e instanceof Array)b+=q(e,d,f);else{var g=m(e);g>0||null!=e.__text||null!=e.__cdata?(b+=i(e,d,f,!1),b+=r(e),b+=j(e,d)):b+=i(e,d,f,!0)}else b+=i(e,d,f,!1),b+=p(e),b+=j(e,d)}return b+=p(a)}(null===b||void 0===b)&&(b="_"),(null===c||void 0===c)&&(c=!1);var s="1.0.11",t=!1,u={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(a){var b,c,d;if(window.DOMParser){c=new window.DOMParser;try{d=c.parseFromString("<","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(e){}try{b=c.parseFromString(a,"text/xml"),d&&b.getElementsByTagNameNS(d,"parsererror").length&&(b=void 0)}catch(e){}}else 0==a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},this.xml2json=function(a){return h(a)},this.xml_str2json=function(a){var b=this.parseXmlString(a);return b?this.xml2json(b):void 0},this.json2xml_str=function(a){return r(a)},this.json2xml=function(a){var b=this.json2xml_str(a);return this.parseXmlString(b)},this.getVersion=function(){return s},this.escapeMode=function(a){t=a}}function milliSecondsToTimeString(a){var b=new Date(a),c=b.getUTCHours(),d=b.getUTCMinutes(),e=b.getSeconds();10>c&&(c="0"+c),10>d&&(d="0"+d),10>e&&(e="0"+e);var f=c+":"+d+":"+e;return f}function secondsToTimeString(a){var b=1e3*a,c=milliSecondsToTimeString(b);return c}function detectBrowser(){var a,b=!1,c=!1;return(window.opera||navigator.userAgent.indexOf(" OPR/")>=0)&&(a="Chrome",b=!0),"undefined"!=typeof InstallTrigger&&(a="FireFox"),Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0&&(a="Safari"),window.chrome&&!b==!0&&(a="Chrome"),document.documentMode&&(a="IE",c=!0),!c&&window.StyleMedia&&(a="Edge"),void 0===a&&(a="Other"),a}function launchDashPlayer(a){var b=new Dash.di.DashContext,c=new MediaPlayer(b);return c.setAutoPlay(!1),c.startup(),c.attachView(document.querySelector("#"+a)),c}function openVideo(){function a(a){var b=new RegExp(/(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/);return b.test(a)?!0:(window.alert("Please enter a valid URL."),!1)}$("#iconPlayPause").hasClass("icon-play")&&$("#iconPlayPause").hasClass("icon-pause")||$("#iconPlayPause").toggleClass("icon-play"),masterQuality=void 0;var b=document.getElementById("mpdURL").value;1==a(b)&&(bannerbox.style.backgroundImage="none",bannerbox.style.background="black",MPDManager(b))}function playPause(){fullBackLayer.paused?(fullBackLayer.play(),video1.play(),video2.play(),video3.play(),video4.play(),$("#iconPlayPause").removeClass("icon-play"),$("#iconPlayPause").toggleClass("icon-pause")):(fullBackLayer.pause(),video1.pause(),video2.pause(),video3.pause(),video4.pause(),$("#iconPlayPause").removeClass("icon-pause"),$("#iconPlayPause").toggleClass("icon-play"))}function muteSound(){fullBackLayer.muted===!1?(lastVolumeValue=fullBackLayer.volume,fullBackLayer.muted=!0,$("#iconMute").removeClass("icon-mute-off"),$("#iconMute").toggleClass("icon-mute-on"),$("#volumebar").val(0)):fullBackLayer.muted===!0&&(fullBackLayer.muted=!1,fullBackLayer.volume=lastVolumeValue,$("#iconMute").removeClass("icon-mute-on"),$("#iconMute").toggleClass("icon-mute-off"),$("#volumebar").val(lastVolumeValue))}function switchScreenMode(){function a(){var a,c;if(document.fullscreenElement||document.webkitIsFullScreen||document.mozFullScreen||null!==document.msFullscreenElement){if(fullBackLayer.style.width="",fullBackLayer.style.height="",fullBackLayerContentAspectRatio!=initialAspectRatio&&updateAspectRatio(fullBackLayer,fullBackLayerContentAspectRatio),zoomLayer1.removeAttribute("width"),zoomLayer1.removeAttribute("height"),zoomLayer2.removeAttribute("width"),zoomLayer2.removeAttribute("height"),$("#fullBackLayer").removeClass("fullscreen"),$("#zoomLayer1").removeClass("fullscreen"),$("#zoomLayer2").removeClass("fullscreen"),$("video").removeClass("fullscreen"),$("#videoContainer").removeClass("fullscreen"),$("#videoController").removeClass("video-controller-fullscreen"),$("#icon-fullscreen").removeClass("icon-fullscreen-exit"),$("#icon-fullscreen").toggleClass("icon-fullscreen-enter"),zoomLayer1VideoHeight=computeVideoDimensions(zoomLayer1ContentAspectRatio,"normal"),zoomLayer1VideoWidth=initialWidth,zoomLayer2VideoHeight=computeVideoDimensions(zoomLayer2ContentAspectRatio,"normal"),zoomLayer2VideoWidth=initialWidth,b(zoomLayer1VideoHeight,zoomLayer1VideoWidth,zoomLayer2VideoHeight,zoomLayer2VideoWidth),$("#zoomLayer1").width(2*zoomLayer1VideoWidth+"px"),$("#zoomLayer1").height(2*zoomLayer1VideoHeight+"px"),$("#zoomLayer2").width(2*zoomLayer2VideoWidth+"px"),$("#zoomLayer2").height(2*zoomLayer2VideoHeight+"px"),fullBackLayer.style.top="0px",void 0==currentZoomLevel)fullScreenZoomedTo=void 0;else if(0==currentZoomLevel){var d=computeVideoDimensions(zoomLayer1ContentAspectRatio,"fullscreen")[0],e=computeVideoDimensions(zoomLayer1ContentAspectRatio,"fullscreen")[1];a=zoomLayer1.offsetLeft/e*zoomLayer1VideoWidth,c=zoomLayer1.offsetTop/d*zoomLayer1VideoHeight,zoomLayer1.style.left=a+"px",zoomLayer1.style.top=c+"px",fullScreenZoomedTo=0}else 1==currentZoomLevel&&(a=zoomLayer2.offsetLeft+zoomLayer2VideoWidth/2,c=zoomLayer2.offsetTop+zoomLayer2VideoHeight/2,zoomLayer2.style.left=a+"px",zoomLayer2.style.top=c+"px",fullScreenZoomedTo=1);fullScreenFlag=!1}}function b(a,b,c,d){video1.height=a,video1.width=b,video2.height=a,video2.width=b,video3.height=a,video3.width=b,video4.height=a,video4.width=b,video5.height=c,video5.width=d,video6.height=c,video6.width=d,video7.height=c,video7.width=d,video8.height=c,video8.width=d}var c;if(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),a();else if(fullScreenFlag=!0,zoomLayer1VideoHeight=computeVideoDimensions(zoomLayer1ContentAspectRatio,"fullscreen")[0],zoomLayer1VideoWidth=computeVideoDimensions(zoomLayer1ContentAspectRatio,"fullscreen")[1],zoomLayer2VideoHeight=computeVideoDimensions(zoomLayer2ContentAspectRatio,"fullscreen")[0],zoomLayer2VideoWidth=computeVideoDimensions(zoomLayer2ContentAspectRatio,"fullscreen")[1],videoContainer.requestFullscreen?videoContainer.requestFullscreen():videoContainer.msRequestFullscreen?videoContainer.msRequestFullscreen():videoContainer.mozRequestFullScreen?videoContainer.mozRequestFullScreen():videoContainer.webkitRequestFullscreen&&videoContainer.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),$("#icon-fullscreen").removeClass("icon-fullscreen-enter"),$("#icon-fullscreen").toggleClass("icon-fullscreen-exit"),$("#zoomLayer1").toggleClass("fullscreen"),$("#zoomLayer2").toggleClass("fullscreen"),SRDPlayer.style.height="",videoContainer.style.height="",bannerbox.style.height="",fullBackLayer.style.width="",fullBackLayer.style.height="",zoomLayer1.width=2*zoomLayer1VideoWidth,zoomLayer1.height=2*zoomLayer1VideoHeight,zoomLayer2.width=2*zoomLayer2VideoWidth,zoomLayer2.height=2*zoomLayer2VideoHeight,$("#fullBackLayer").toggleClass("fullscreen"),$("#videoContainer").toggleClass("fullscreen"),$("#bannerbox").toggleClass("bannerbox-fullscreen"),$("#videoController").toggleClass("video-controller-fullscreen"),b(zoomLayer1VideoHeight,zoomLayer1VideoWidth,zoomLayer2VideoHeight,zoomLayer2VideoWidth),0==currentZoomLevel){var d=parseInt(zoomLayer1.offsetLeft,10)/initialWidth*zoomLayer1VideoWidth,e=parseInt(zoomLayer1.offsetTop,10)/(initialHeight/zoomLayer1ContentAspectRatio)*zoomLayer1VideoHeight,f=zoomLayer1.height,g=screen.height;g-f>e&&(e=g-f),zoomLayer1.style.left=d+"px",zoomLayer1.style.top=e+"px",fullBackLayer.style.left=d+"px",fullBackLayer.style.top=e+"px"}else if(1==currentZoomLevel){var d=parseInt(zoomLayer2.offsetLeft,10)/initialWidth*zoomLayer2VideoWidth,e=parseInt(zoomLayer2.offsetTop,10)/(initialHeight/zoomLayer2ContentAspectRatio)*zoomLayer2VideoHeight,f=zoomLayer2.height,g=screen.height;g-f>e&&(e=g-f),zoomLayer2.style.left=d+"px",zoomLayer2.style.top=e+"px",fullBackLayer.style.left=d+"px",fullBackLayer.style.top=e+"px"}c="webkitfullscreenchange fullscreenchange MSFullscreenChange","FireFox"===browserType?setTimeout(function(){document.mozFullScreen&&$(document).one("mozfullscreenchange",function(){a()})},300):setTimeout(function(){(document.webkitIsFullScreen||document.fullscreen||document.msFullscreenElement)&&$(videoContainer).one(c,function(){a()})},150)}function onClickEvent(a){var b,c,d,e;0==fullScreenFlag?(b=getPosition(a.currentTarget),c=-(a.clientX-b.x),d=-(a.clientY-b.y)):(c=-a.clientX,d=-a.clientY),"undefined"==typeof currentZoomLevel?(e=zoomLayer1,currentZoomLevel=0,fullScreenFlag?updateVideoContainer(c,d,fullBackLayer,null,"fullscreen"):updateVideoContainer(c,d,fullBackLayer,null,2),ServiceBus.publish("Zoom-level1",[c,d,e]),zoomLayer1Status="attached",zoomLayer1.setAttribute("onmousedown","dragtool.startMoving(this, videoContainer, event);"),zoomLayer1.setAttribute("onmouseup","dragtool.stopMoving(videoContainer);")):0===currentZoomLevel&&(e=fullBackLayer,zoomLayer1.removeAttribute("onmousedown"),zoomLayer1.removeAttribute("onmouseup"),resetPlayers(zoomLayer1PlayerObjects),void 0==fullScreenZoomedTo?updateVideoContainer(c,d,e,null,.5):(updateVideoContainer(c,d,e,null,1),fullScreenZoomedTo=void 0),currentZoomLevel=void 0)}function getPosition(a){var b=0,c=0;if(0==fullScreenFlag)for(;a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop,a=a.offsetParent;else for(;a;)b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{x:b,y:c}}function updateVideoContainer(a,b,c,d,e){if(c==fullBackLayer){if(1==fullScreenFlag)if("fullscreen"==e)fullBackLayer.style.height=screen.width/fullBackLayerContentAspectRatio*2+"px",fullBackLayer.style.width=2*screen.width+"px";else{var f=parseInt(fullBackLayer.offsetHeight,10)*e,g=parseInt(fullBackLayer.offsetWidth,10)*e;fullBackLayer.style.height=f+"px",fullBackLayer.style.width=g+"px"}else if(0==fullScreenFlag){var f=parseInt(fullBackLayer.offsetHeight,10)*e,g=parseInt(fullBackLayer.offsetWidth,10)*e;fullBackLayer.style.height=f+"px",fullBackLayer.style.width=g+"px"}if(.5===e){var h=(parseInt(videoContainer.offsetHeight,10)-parseInt(fullBackLayer.offsetHeight,10))/2;fullBackLayer.style.left="0px",fullBackLayer.style.top=h+"px",setVisibleElement("fullbacklayer")}else 1===e?(fullBackLayer.style.left="0px",fullBackLayer.style.top="0px",setVisibleElement("fullbacklayer")):2===e?(fullBackLayer.style.left=a+"px",fullBackLayer.style.top=b+"px"):"fullscreen"===e&&(fullBackLayer.style.left=a+"px",fullBackLayer.style.top=b+"px",setVisibleElement("fullbacklayer"))}else if(c==zoomLayer1){var h=(parseInt(videoContainer.offsetHeight,10)-parseInt(zoomLayer1.offsetHeight,10)/2)/2;zoomLayer1.style.left=a+"px",zoomLayer1.style.top=b+h+"px",setTimeout(function(){setVisibleElement("zoomlayer1")},d)}else c==zoomLayer2&&(zoomLayer2.style.left=a+"px",zoomLayer2.style.top=b+"px",setTimeout(function(){setVisibleElement("zoomlayer2")},d))}function updateAspectRatio(a,b){a==fullBackLayer&&(SRDPlayer.style.height=initialWidth/b+188+"px",videoContainer.style.height=initialWidth/b+"px",fullBackLayer.style.height=initialWidth/b+"px",bannerbox.style.height=initialWidth/b+"px")}function setVisibleElement(a){"fullbacklayer"===a?(fullBackLayer.style.visibility="visible",zoomLayer1.style.visibility="hidden",zoomLayer2.style.visibility="hidden",bannerbox.style.visibility="hidden"):"zoomlayer1"===a?(zoomLayer1.style.visibility="visible",fullBackLayer.style.visibility="hidden",zoomLayer2.style.visibility="hidden",bannerbox.style.visibility="hidden"):"zoomlayer2"===a?(zoomLayer2.style.visibility="visible",fullBackLayer.style.visibility="hidden",zoomLayer1.style.visibility="hidden",bannerbox.style.visibility="hidden"):"bannerbox"===a&&(bannerbox.style.visibility="visible",fullBackLayer.style.visibility="hidden",zoomLayer1.style.visibility="hidden",zoomLayer2.style.visibility="hidden")}function computeVideoDimensions(a,b){if(void 0==a&&(a=fullBackLayerContentAspectRatio),"fullscreen"==b){var c,d;return screenAspectRatio==a?(c=screen.height,d=screen.width):a>screenAspectRatio?(c=screen.width/a,d=screen.width):screenAspectRatio>a&&(c=screen.width/a,d=screen.width),[c,d]}if("normal"==b){var e;return e=initialWidth/a}}function initiatePlayBack(a,b,c,d){var e,f,g,h,i;h=.001,e=estimateTimeUpdateFrequency(c,e,d),$("#fullBackLayer").one("timeupdate",function(){f=a.currentTime,setTimeout(function(){g=a.currentTime,g>f&&(h+=g-f),i=f+h;for(var c=0;c<b.length;c++){var d=b[c];d.currentTime=i}if(!a.paused)for(var c=0;c<b.length;c++){var d=b[c];d.play()}},e);for(var c=0;c<zoomLayer1PlayerObjects.length;c++){var d=zoomLayer1PlayerObjects[c];0===c&&d.getBitrateInfoListFor("video").length>1&&(masterQuality=d.getQualityFor("video")),c>0&&masterQuality&&(d.setAutoSwitchQuality(!1),d.setQualityFor("video",masterQuality))}})}function estimateTimeUpdateFrequency(a,b,c){return b="FireFox"===a?1e3/c:timeUpdateIntervals[a]}function emitBitrateChanges(a,b){a[0].eventBus.addEventListener(MediaPlayer.events.METRIC_CHANGED,function(){var c=a[0].getQualityFor("video");if(b!=c){b=c;for(var d=1;d<a.length;d++){var e=a[d];d>0&&e.setQualityFor("video",b)}}})}function resetPlayers(a){for(var b=0;b<a.length;b++){var c=a[b];c.reset()}}function updateViewLayerOnReadyState(a,b,c,d){for(var e=0;e<a.length;e++)4===!a[e].ReadyState&&(e-=1),3===e&&updateVideoContainer(b,c,d,1200,null)}var SRDPlayer,videoContainer,bannerbox,frameRate,fullBackLayer,zoomLayer1,zoomLayer2,video1,video2,video3,video4,video5,video6,video7,video8,zoomLayer1VideoElements,zoomLayer2VideoElements,visibleElement,zoomLayer1PlayerObjects,zoomLayer2PlayerObjects,videoController,getClickPositionEnabled,mpdURL,inMPD,currentZoomLevel,maxZoomLevel,zoomLayer1Status,fullScreenFlag,fullScreenZoomedTo,browserType,duration,timeUpdateIntervals,initialWidth,initialHeight,initialAspectRatio,fullBackLayerContentWidth,fullBackLayerContentHeight,fullBackLayerContentAspectRatio,zoomLayer1ContentWidth,zoomLayer1ContentHeight,zoomLayer1ContentAspectRatio,zoomLayer2ContentWidth,zoomLayer2ContentHeight,zoomLayer2ContentAspectRatio,screenAspectRatio,contentHasAudio,contentAspectRatio,lastVolumeValue,masterQuality,videoControllerClone,viewState,zoomLayer1VideoHeight,zoomLayer1VideoWidth,zoomLayer2VideoHeight,zoomLayer2VideoWidth;$(document).ready(function(){SRDPlayer=document.getElementById("SRDPlayer"),videoContainer=document.getElementById("videoContainer"),bannerbox=document.getElementById("bannerbox"),fullBackLayer=document.getElementById("fullBackLayer"),zoomLayer1=document.getElementById("zoomLayer1"),zoomLayer2=document.getElementById("zoomLayer2"),video1=document.getElementById("video1"),video2=document.getElementById("video2"),video3=document.getElementById("video3"),video4=document.getElementById("video4"),video5=document.getElementById("video5"),video6=document.getElementById("video6"),video7=document.getElementById("video7"),video8=document.getElementById("video8"),videoController=document.getElementById("videoController"),zoomLayer1VideoElements=[video1,video2,video3,video4],zoomLayer2VideoElements=[video5,video6,video7,video8],zoomLayer1PlayerObjects=[],zoomLayer2PlayerObjects=[],fullBackLayer.style.visibility="visible",zoomLayer1.style.visibility="hidden",zoomLayer2.style.visibility="hidden",video1.muted=!0,video2.muted=!0,video3.muted=!0,video4.muted=!0,video5.muted=!0,video6.muted=!0,video7.muted=!0,video8.muted=!0,getClickPositionEnabled=!1,zoomLayer1Status=null,fullScreenFlag=!1,timeUpdateIntervals={Chrome:250,Safari:250,Opera:250,IE:250,Edge:250,Other:250},screenAspectRatio=screen.width/screen.height,initialWidth=parseInt(fullBackLayer.offsetWidth,10),initialHeight=parseInt(fullBackLayer.offsetHeight,10),initialAspectRatio=initialWidth/initialHeight,browserType=detectBrowser()});var SynchroniseVideos=function(){var a={a:Popcorn("#fullBackLayer"),b:Popcorn("#video1"),c:Popcorn("#video2"),d:Popcorn("#video3"),e:Popcorn("#video4")},b=$("#seekbar"),c=0,d="play pause timeupdate seeking".split(/\s+/g);Popcorn.forEach(a,function(e,f){e.on("canplayall",function(){this.emit("syncVideos"),b.attr("max",this.duration())}).on("syncVideos",function(){4==++c&&d.forEach(function(c){a.a.on(c,function(){if("timeupdate"===c){if(!this.media.paused)return;return a.b.emit("timeupdate"),a.c.emit("timeupdate"),a.d.emit("timeupdate"),a.e.emit("timeupdate"),void b.val(this.currentTime())}"seeking"===c&&(a.b.currentTime(this.currentTime()),a.c.currentTime(this.currentTime()),a.d.currentTime(this.currentTime()),a.e.currentTime(this.currentTime())),("play"===c||"pause"===c)&&(a.b[c](),a.c[c](),a.d[c](),a.e[c]())})})})}),b.bind("change",function(){var b=this.value;a.a.currentTime(b),a.b.currentTime(b),a.c.currentTime(b),a.d.currentTime(b),a.e.currentTime(b)})},lastUid=-1,ServiceBus={topics:{},subscribe:function(a,b,c){this.topics[a]||(this.topics[a]=[]);var d=(++lastUid).toString();this.topics[a].push({listener:b,token:d,subscriber:c});var c=c;return console.log("Subscribing "+c+" to topic "+a),d},unsubscribe:function(a,b){for(var c=0;c<this.topics[a].length;c++)this.topics[a][c].token===b&&(console.log("Unsubscribing "+this.topics[a][c].subscriber+" from topic"+a),this.topics[a].splice(c,1))},publish:function(a,b){var c=this.topics[a].length;if(this.topics[a]&&!(1>c))for(var d=0;c>d;d++){var e=this.topics[a][d].listener;console.log("Publishing topic "+a+" to subscriber "+this.topics[a][d].subscriber),e(b||{})}}},SECONDS_IN_YEAR=31536e3,SECONDS_IN_MONTH=2592e3,SECONDS_IN_DAY=86400,SECONDS_IN_HOUR=3600,SECONDS_IN_MIN=60,MINUTES_IN_HOUR=60,MILLISECONDS_IN_SECONDS=1e3,durationRegex=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,datetimeRegex=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,numericRegex=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,httpOrHttpsRegex=/^https?:\/\//i,matchers=[{type:"duration",test:function(a){for(var b=["minBufferTime","mediaPresentationDuration","minimumUpdatePeriod","timeShiftBufferDepth","maxSegmentDuration","maxSubsegmentDuration","suggestedPresentationDelay","start","starttime","duration"],c=b.length,d=0;c>d;d++)if(a.nodeName===b[d])return durationRegex.test(a.value);return!1},converter:function(a){var b=durationRegex.exec(a),c=parseFloat(b[2]||0)*SECONDS_IN_YEAR+parseFloat(b[4]||0)*SECONDS_IN_MONTH+parseFloat(b[6]||0)*SECONDS_IN_DAY+parseFloat(b[8]||0)*SECONDS_IN_HOUR+parseFloat(b[10]||0)*SECONDS_IN_MIN+parseFloat(b[12]||0);return void 0!==b[1]&&(c=-c),c}},{type:"datetime",test:function(a){return datetimeRegex.test(a.value)},converter:function(a){var b,c=datetimeRegex.exec(a);if(b=Date.UTC(parseInt(c[1],10),parseInt(c[2],10)-1,parseInt(c[3],10),parseInt(c[4],10),parseInt(c[5],10),c[6]&&parseInt(c[6],10)||0,c[7]&&parseFloat(c[7])*MILLISECONDS_IN_SECONDS||0),c[9]&&c[10]){var d=parseInt(c[9],10)*MINUTES_IN_HOUR+parseInt(c[10],10);b+=("+"===c[8]?-1:1)*d*SECONDS_IN_MIN*MILLISECONDS_IN_SECONDS}return new Date(b)}},{type:"numeric",test:function(a){return numericRegex.test(a.value)},converter:function(a){return parseFloat(a)}}],MPDRetriever=function(a){this.params=a};MPDRetriever.prototype={retrieveAndConvert:function(a,b){crossOriginRequest(a,function(a,c){return a?console.err(a):void b(null,c)})},getMPD:function(){var a=this.params.mpdURL;this.retrieveAndConvert(a,function(b,c){return b?console.err(b):void ServiceBus.publish("MPD-incoming",[a,c])})}};var MPDParser=function(){ServiceBus.subscribe("MPD-incoming",this.parseMPD,"MPDParser")};MPDParser.prototype={parseMPD:function(a){mpdURL=a[0];var b=new X2JS(matchers,"",!0),c=b.xml_str2json(a[1]);void 0===c.Period.AdaptationSet[0].SupplementalProperty?ServiceBus.publish("Non-SRD-MPD",[mpdURL,c]):ServiceBus.publish("SRD-MPD",[mpdURL,c])}};var normalVideoAttacher=function(){ServiceBus.subscribe("Non-SRD-MPD",this.attacher,"normalVideoAttacher")};normalVideoAttacher.prototype={attacher:function(a){getClickPositionEnabled===!0&&videoContainer.removeEventListener("dblclick",getClickPosition);var b=launchDashPlayer("fullBackLayer");b.attachSource(a),$.when(4===fullBackLayer.readyState).then(function(){playPause()})}};var tiledVideoAttacher=function(){ServiceBus.subscribe("SRD-MPD",this.fullBackLayerAttacher,"fullBackLayerAttacher"),ServiceBus.subscribe("Zoom-level1",this.zoomLayer1Attacher,"zoomLayer1Attacher"),ServiceBus.subscribe("Zoom-level2",this.zoomLayer2Attacher,"zoomLayer2Attacher")};tiledVideoAttacher.prototype={fullBackLayerAttacher:function(a){var b;inMPD=a[1];var c=inMPD.Period.AdaptationSet,d=c.slice(0,1),e=c.slice(1,2);"audio/mp4"==e[0].mimeType?(b=[d[0],e[0]],contentHasAudio=!0):(b=d,contentHasAudio=!1),frameRate=d[0].Representation.frameRate,fullBackLayerContentWidth=d[0].Representation.width,fullBackLayerContentHeight=d[0].Representation.height,fullBackLayerContentAspectRatio=fullBackLayerContentWidth/fullBackLayerContentHeight,fullBackLayerContentAspectRatio!=initialAspectRatio&&updateAspectRatio(fullBackLayer,fullBackLayerContentAspectRatio);var f={__cnt:inMPD.__cnt,"#comment":inMPD["#comment"],"#comment_asArray":inMPD["#comment_asArray"],BaseURL:inMPD.BaseURL,BaseURL_asArray:inMPD.BaseURL_asArray,Period:{__cnt:inMPD.Period.__cnt,AdaptationSet:b,AdaptationSet_asArray:b,__children:b},Period_asArray:[{AdaptationSet:b,AdaptationSet_asArray:b,__children:b}],xmlns:inMPD.xmlns,mediaPresentationDuration:inMPD.mediaPresentationDuration,minBufferTime:inMPD.minBufferTime,profiles:inMPD.profiles,type:inMPD.type,__text:inMPD.__text},g=launchDashPlayer("fullBackLayer"),h=[mpdURL,f];g.attachSource(h),$("#fullBackLayer").one("canplay",function(){playPause(),duration=fullBackLayer.duration,document.getElementById("videoDuration").innerHTML=secondsToTimeString(duration);var a=duration/4;setInterval(function(){document.getElementById("videoTime").innerHTML=secondsToTimeString(fullBackLayer.currentTime),$("#seekbar").val(fullBackLayer.currentTime)},a),SynchroniseVideos(),$("#volumebar").bind("change",function(){var a=this.value;fullBackLayer.volume=a})}),getClickPositionEnabled===!1&&(videoContainer.addEventListener("dblclick",onClickEvent,!1),getClickPositionEnabled=!0);var i=c.length,j=c.slice(i-1,i),k=j[0].EssentialProperty.value.length;if(maxZoomLevel=j[0].EssentialProperty.value.slice(k-1,k),0==contentHasAudio)var l=0;else var l=1;for(var m=1+l;m<c.length;m++){var k=c[m].EssentialProperty.value.length,n=c[m].EssentialProperty.value.slice(k-1,k);if(0==n)m==1+l&&(zoomLayer1ContentWidth=c[m].Representation.width,zoomLayer1ContentHeight=c[m].Representation.height,zoomLayer1ContentAspectRatio=zoomLayer1ContentWidth/zoomLayer1ContentHeight);else if(1==n){zoomLayer2ContentWidth=c[m].Representation.width,zoomLayer2ContentHeight=c[m].Representation.height,zoomLayer2ContentAspectRatio=zoomLayer1ContentWidth/zoomLayer1ContentHeight;break}}},zoomLayer1Attacher:function(a){var b=inMPD.Period.AdaptationSet,c=[],d=a[0],e=a[1],f=a[2];if(0==contentHasAudio)var g=0;else var g=1;for(var h=1+g;h<b.length;h++){var i=b[h].EssentialProperty.value.length,j=b[h].EssentialProperty.value.slice(i-1,i);if(j==currentZoomLevel){var k=h-(1+g);c[k]={__cnt:inMPD.__cnt,"#comment":inMPD["#comment"],"#comment_asArray":inMPD["#comment_asArray"],BaseURL:inMPD.BaseURL,BaseURL_asArray:inMPD.BaseURL_asArray,Period:{__cnt:inMPD.Period.__cnt,AdaptationSet:b[h],AdaptationSet_asArray:[b[h]],__children:b[h]},Period_asArray:[{AdaptationSet:b[h],AdaptationSet_asArray:[b[h]],__children:b[h]}],xmlns:inMPD.xmlns,mediaPresentationDuration:inMPD.mediaPresentationDuration,minBufferTime:inMPD.minBufferTime,profiles:inMPD.profiles,type:inMPD.type,__text:inMPD.__text},h==1+g&&(zoomLayer1ContentWidth=b[h].Representation.width,zoomLayer1ContentHeight=b[h].Representation.height,zoomLayer1ContentAspectRatio=zoomLayer1ContentWidth/zoomLayer1ContentHeight)}else if(j>currentZoomLevel)break}zoomLayer1PlayerObjects=[];for(var h=0;h<zoomLayer1VideoElements.length;h++){var l="video"+(h+1),m=launchDashPlayer(l);zoomLayer1PlayerObjects.push(m)}for(var h=0;h<zoomLayer1PlayerObjects.length;h++){var m=zoomLayer1PlayerObjects[h],n=[mpdURL,c[h]];m.attachSource(n)}initiatePlayBack(fullBackLayer,zoomLayer1VideoElements,browserType,frameRate,f),updateViewLayerOnReadyState(zoomLayer1VideoElements,d,e,f),getClickPositionEnabled===!1&&(videoContainer.addEventListener("dblclick",onClickEvent,!1),getClickPositionEnabled=!0),masterQuality&&emitBitrateChanges(zoomLayer1PlayerObjects,masterQuality)},zoomLayer2Attacher:function(a){for(var b=(a[0],a[1],inMPD.Period.AdaptationSet),c=[],d=2;d<b.length;d++){var e=b[d].Representation.BaseURL,f=e.substring(e.lastIndexOf("Level_")+6,e.lastIndexOf("/Tile_"));if(f==currentZoomLevel){var g=new Object(inMPD),h=b.slice(d,d+1);g.Period.AdaptationSet=h,g.Period.AdaptationSet_asArray=h,g.Period.__children=h,g.Period_asArray[0].AdaptationSet=h,g.Period_asArray[0].AdaptationSet_asArray=h,g.Period_asArray[0].__children=h,c.push(g)}else if(f>currentZoomLevel)break}for(var d=0;d<playerObjects.length;d++){var i=playerObjects[d];i.attachSource([mpdURL,c[d]])}for(var d=0;d<zoomLayerVideoElements.length;d++){var j=zoomLayerVideoElements[d];$.when(4===j.readyState).then(setTimeout(function(){playPause()},1))}}};var MPDManager=function(a){new normalVideoAttacher,new tiledVideoAttacher,new MPDParser;var b=new MPDRetriever;b.params={mpdURL:a},b.getMPD()},dragtool=function(){return{move:function(a,b,c){a.style.left=b+"px",a.style.top=c+"px",fullBackLayer.style.left=b+"px",fullBackLayer.style.top=c+"px"},startMoving:function(a,b,c){var d=parseInt(a.offsetWidth,10),e=parseInt(a.offsetHeight,10),f=parseInt(b.offsetWidth,10),g=parseInt(b.offsetHeight,10),c=c||window.event;b.style.cursor="move",b.onmousemove=function(b){b=b||window.event;var c,h,i;0==fullScreenFlag?(c=getPosition(b.currentTarget),h=b.clientX-c.x-(d/2+f)/2,i=b.clientY-c.y-(e/2+g)/2):(h=b.clientX-(d/2+f)/2,i=b.clientY-(e/2+g)/2),-(d-f)>h&&(h=-(d-f)),-(e-g)>i&&(i=-(e-g)),h>0&&(h=0),i>0&&(i=0),dragtool.move(a,h,i)}},stopMoving:function(a){a.style.cursor="default",a.onmousemove=function(){}}}}();