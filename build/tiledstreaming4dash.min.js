/*! tiledstreaming4dash 2015-12-22 */
"use strict";function crossOriginRequest(a,b){function c(a,b){var c;return c=g?new window.XDomainRequest:new XMLHttpRequest}function d(){h?g?(h.onload=f,h.open("GET",a,!0),h.send()):(h.open("GET",a,!0),h.onreadystatechange=e,h.send()):console.log("callOtherDomain: No Invocation TookPlace At All")}function e(a){4==h.readyState&&(200==h.status?f():console.log("crossOriginRequestHandler: Invocation Errors Occured"))}function f(){var a=h.responseText;b(null,a)}var g=window.XDomainRequest?!0:!1,h=c();d()}function syncVideos(){4===videos.b.media.readyState&&videos.b.currentTime(videos.a.currentTime()),4===videos.c.media.readyState&&videos.c.currentTime(videos.a.currentTime()),4===videos.d.media.readyState&&videos.d.currentTime(videos.a.currentTime()),4===videos.e.media.readyState&&videos.e.currentTime(videos.a.currentTime()),requestAnimationFrame(syncVideos)}function openVideo(){function a(a,b){var c=new Dash.di.DashContext,e=new MediaPlayer(c);e.setAutoPlay(!1),e.startup(),e.attachView(document.querySelector("#"+b)),e.attachSource(a),d.push(e)}bannerbox.style.visibility="hidden";for(var b=document.getElementById("mpdURL").value,c=["videonormal","video1","video2","video3","video4"],d=[],e=0;e<c.length;e++){var f=c[e];a(b,f)}setTimeout(function(){playPause()},1200)}function playPause(){videonormal.paused?(videonormal.play(),video1.play(),video2.play(),video3.play(),video4.play()):(videonormal.pause(),video1.pause(),video2.pause(),video3.pause(),video4.pause())}function makeBig(){videonormal.width=560,videoContainer.width=560,videoContainer.height=315,video1.width=560,video2.width=560,video3.width=560,video4.width=560}function makeSmall(){videonormal.width=320,videoContainer.width=320,videoContainer.height=180,video1.width=320,video2.width=320,video3.width=320,video4.width=320}function makeNormal(){videonormal.width=420,videoContainer.width=420,videoContainer.height=236,video1.width=420,video2.width=420,video3.width=420,video4.width=420}function swapVideos(){return"visible"==videonormal.style.visibility&&"hidden"==tiletable.style.visibility?(videonormal.style.visibility="hidden",void(tiletable.style.visibility="visible")):"hidden"==videonormal.style.visibility&&"visible"==tiletable.style.visibility?(videonormal.style.visibility="visible",void(tiletable.style.visibility="hidden")):void 0}function getClickPosition(a){var b=getPosition(a.currentTarget),c=a.clientX-b.x-tiletable.clientWidth/2,d=a.clientY-b.y-tiletable.clientHeight/2;setTimeout(function(){swapVideos(),tiletable.style.left=c+"px",tiletable.style.top=d+"px"},600)}function getPosition(a){for(var b=0,c=0;a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop,a=a.offsetParent;return{x:b,y:c}}var lastUid=-1,ServiceBus={topics:{},subscribe:function(a,b,c){this.topics[a]||(this.topics[a]=[]);var d=(++lastUid).toString();this.topics[a].push({listener:b,token:d,subscriber:c});var c=c;return console.log("Subscribing "+c+" to topic "+a),d},unsubscribe:function(a,b){for(var c=0;c<this.topics[a].length;c++)this.topics[a][c].token===b&&(console.log("Unsubscribing "+this.topics[a][c].subscriber+" from topic"+a),this.topics[a].splice(c,1))},publish:function(a,b){var c=this.topics[a].length;if(this.topics[a]&&!(1>c))for(var d=0;c>d;d++){var e=this.topics[a][d].listener;console.log("Publishing topic "+a+" to subscriber "+this.topics[a][d].subscriber),e(b||{})}}},xmlToJSON=function(){this.version="1.3";var a={mergeCDATA:!0,grokAttr:!0,grokText:!0,normalize:!0,xmlns:!0,namespaceKey:"_ns",textKey:"_text",valueKey:"_value",attrKey:"_attr",cdataKey:"_cdata",attrsAsObject:!0,stripAttrPrefix:!0,stripElemPrefix:!0,childrenAsArray:!0},b=new RegExp(/(?!xmlns)^.*:/),c=new RegExp(/^\s+|\s+$/g);return this.grokType=function(a){return/^\s*$/.test(a)?null:/^(?:true|false)$/i.test(a)?"true"===a.toLowerCase():isFinite(a)?parseFloat(a):a},this.parseString=function(a,b){return this.parseXML(this.stringToXML(a),b)},this.parseXML=function(d,e){for(var f in e)a[f]=e[f];var g={},h=0,i="";if(a.xmlns&&d.namespaceURI&&(g[a.namespaceKey]=d.namespaceURI),d.attributes&&d.attributes.length>0){var j={};for(h;h<d.attributes.length;h++){var k=d.attributes.item(h);o={};var l="";l=a.stripAttrPrefix?k.name.replace(b,""):k.name,a.grokAttr?o[a.valueKey]=this.grokType(k.value.replace(c,"")):o[a.valueKey]=k.value.replace(c,""),a.xmlns&&k.namespaceURI&&(o[a.namespaceKey]=k.namespaceURI),a.attrsAsObject?j[l]=o:g[a.attrKey+l]=o}a.attrsAsObject&&(g[a.attrKey]=j)}if(d.hasChildNodes())for(var m,n,o,p=0;p<d.childNodes.length;p++)m=d.childNodes.item(p),4===m.nodeType?a.mergeCDATA?i+=m.nodeValue:g.hasOwnProperty(a.cdataKey)?(g[a.cdataKey].constructor!==Array&&(g[a.cdataKey]=[g[a.cdataKey]]),g[a.cdataKey].push(m.nodeValue)):a.childrenAsArray?(g[a.cdataKey]=[],g[a.cdataKey].push(m.nodeValue)):g[a.cdataKey]=m.nodeValue:3===m.nodeType?i+=m.nodeValue:1===m.nodeType&&(0===h&&(g={}),n=a.stripElemPrefix?m.nodeName.replace(b,""):m.nodeName,o=xmlToJSON.parseXML(m),g.hasOwnProperty(n)?(g[n].constructor!==Array&&(g[n]=[g[n]]),g[n].push(o)):(a.childrenAsArray?(g[n]=[],g[n].push(o)):g[n]=o,h++));else i||(a.childrenAsArray?(g[a.textKey]=[],g[a.textKey].push(null)):g[a.textKey]=null);if(i)if(a.grokText){var q=this.grokType(i.replace(c,""));null!==q&&void 0!==q&&(g[a.textKey]=q)}else a.normalize?g[a.textKey]=i.replace(c,"").replace(/\s+/g," "):g[a.textKey]=i.replace(c,"");return g},this.xmlToString=function(a){try{var b=a.xml?a.xml:(new XMLSerializer).serializeToString(a);return b}catch(c){return null}},this.stringToXML=function(a){try{var b=null;if(window.DOMParser){var c=new DOMParser;return b=c.parseFromString(a,"text/xml")}return b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a),b}catch(d){return null}},this}.call({});"undefined"!=typeof module&&null!==module&&module.exports?module.exports=xmlToJSON:"function"==typeof define&&define.amd&&define(function(){return xmlToJSON});var bannerbox=document.getElementById("bannerbox"),videonormal=document.getElementById("videonormal"),tiletable=document.getElementById("tiletable"),video1=document.getElementById("video1"),video2=document.getElementById("video2"),video3=document.getElementById("video3"),video4=document.getElementById("video4");videonormal.style.visibility="visible",tiletable.style.visibility="hidden",video1.muted=!0,video2.muted=!0,video3.muted=!0,video4.muted=!0,videoContainer.addEventListener("click",getClickPosition,!1);var videos={a:Popcorn("#videonormal"),b:Popcorn("#video1"),c:Popcorn("#video2"),d:Popcorn("#video3"),e:Popcorn("#video4")},scrub=$("#scrub"),loadCount=0,events="play pause timeupdate seeking".split(/\s+/g);Popcorn.forEach(videos,function(a,b){a.on("canplayall",function(){this.emit("syncVideos"),scrub.attr("max",this.duration())}).on("syncVideos",function(){4==++loadCount&&events.forEach(function(a){videos.a.on(a,function(){if("timeupdate"===a){if(!this.media.paused)return;return videos.b.emit("timeupdate"),videos.c.emit("timeupdate"),videos.d.emit("timeupdate"),videos.e.emit("timeupdate"),void scrub.val(this.currentTime())}"seeking"===a&&(videos.b.currentTime(this.currentTime()),videos.c.currentTime(this.currentTime()),videos.d.currentTime(this.currentTime()),videos.e.currentTime(this.currentTime())),("play"===a||"pause"===a)&&(videos.b[a](),videos.c[a](),videos.d[a](),videos.e[a]())})})})}),scrub.bind("change",function(){var a=this.value;videos.a.currentTime(a),videos.b.currentTime(a),videos.c.currentTime(a),videos.d.currentTime(a),videos.e.currentTime(a)});var MPDRetriever=function(a){this.params=a};MPDRetriever.prototype={retrieveAndConvert:function(a,b){crossOriginRequest(a,function(a,c){if(a)return console.err(a);var d=xmlToJSON.parseString(c);b(null,d)})},getMPD:function(){this.retrieveAndConvert(this.params.mpdURL,function(a,b){return a?console.err(a):void ServiceBus.publish("MPD-incoming",b)})}};var MPDParser=function(){ServiceBus.subscribe("MPD-incoming",this.parseMPD,"MPDParser")};MPDParser.prototype={parseMPD:function(a){console.log(JSON.stringify(a,null,4))}};