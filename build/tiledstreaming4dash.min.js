/*! tiledstreaming4dash 2015-12-16 */
"use strict";var lastUid=-1,ServiceBus={topics:{},subscribe:function(a,b,c){this.topics[a]||(this.topics[a]=[]);var d=(++lastUid).toString();this.topics[a].push({listener:b,token:d,subscriber:c});var c=c;return console.log("Subscribing "+c+" to topic "+a),d},unsubscribe:function(a,b){for(var c=0;c<this.topics[a].length;c++)this.topics[a][c].token===b&&(console.log("Unsubscribing "+this.topics[a][c].subscriber+" from topic"+a),this.topics[a].splice(c,1))},publish:function(a,b){var c=this.topics[a].length;if(this.topics[a]&&!(1>c))for(var d=0;c>d;d++){var e=this.topics[a][d].listener;console.log("Publishing topic "+a+" to subscriber "+this.topics[a][d].subscriber),e(b||{})}}},MPDRetriever=function(a){this.params=a};MPDRetriever.prototype={retrieveAndConvert:function(a,b){crossOriginRequest(a,function(a,c){if(a)return console.err(a);var d=new X2JS,e=d.parseXmlString(c);b(null,d.xml2json(e))})},getMPD:function(){this.retrieveAndConvert(this.params.mpdURL,function(a,b){return a?console.err(a):void ServiceBus.publish("MPD-incoming",b)})}};var MPDParser=function(){ServiceBus.subscribe("MPD-incoming",this.parseMPD,"MPDParser")};MPDParser.prototype={parseMPD:function(a){console.log(JSON.stringify(a,null,4))}};